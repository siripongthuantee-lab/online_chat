<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel Pro - Online Talk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        body {
            background-color: #f5f1e8 !important;
            font-family: 'Prompt', sans-serif;
        }
        .neobrutalism-shadow {
            box-shadow: 8px 8px 0px 0px rgba(0,0,0,1);
        }
        .tab-btn {
            transition: all 0.2s;
        }
        .tab-btn.active {
            background-color: #FFD93D !important;
            transform: translateY(-2px);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stat-card {
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-4px);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b-4 border-black sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-red-500 border-2 border-black rounded-lg flex items-center justify-center text-2xl">
                    üõ°Ô∏è
                </div>
                <div>
                    <h1 class="text-2xl font-bold">Admin Panel Pro</h1>
                    <p id="headerEmail" class="text-sm text-gray-600">loading...</p>
                </div>
            </div>
            <div class="flex gap-2">
                <a href="index.html" class="px-4 py-2 bg-white border-2 border-black rounded-lg font-bold hover:bg-gray-100">
                    üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </a>
                <button id="logoutBtn" class="px-4 py-2 bg-red-500 text-white border-2 border-black rounded-lg font-bold hover:bg-red-600">
                    üö™ ‡∏≠‡∏≠‡∏Å
                </button>
            </div>
        </div>
    </header>

    <div id="app" class="max-w-7xl mx-auto px-4 py-6">
        <!-- Loading -->
        <div id="loading" class="text-center py-20">
            <div class="w-20 h-20 border-8 border-black border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-xl font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>

        <!-- Main Content -->
        <div id="mainContent" style="display:none;">
            <!-- Quick Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="stat-card bg-gradient-to-br from-blue-400 to-blue-500 border-4 border-black rounded-2xl p-6 neobrutalism-shadow">
                    <div class="text-4xl mb-2">üë•</div>
                    <div class="text-3xl font-bold text-white" id="statUsers">0</div>
                    <div class="text-sm font-bold text-white">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card bg-gradient-to-br from-red-400 to-red-500 border-4 border-black rounded-2xl p-6 neobrutalism-shadow">
                    <div class="text-4xl mb-2">üõ°Ô∏è</div>
                    <div class="text-3xl font-bold text-white" id="statAdmins">0</div>
                    <div class="text-sm font-bold text-white">Admin</div>
                </div>
                <div class="stat-card bg-gradient-to-br from-green-400 to-green-500 border-4 border-black rounded-2xl p-6 neobrutalism-shadow">
                    <div class="text-4xl mb-2">üè†</div>
                    <div class="text-3xl font-bold text-white" id="statRooms">0</div>
                    <div class="text-sm font-bold text-white">‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card bg-gradient-to-br from-purple-400 to-purple-500 border-4 border-black rounded-2xl p-6 neobrutalism-shadow">
                    <div class="text-4xl mb-2">üí¨</div>
                    <div class="text-3xl font-bold text-white" id="statMessages">0</div>
                    <div class="text-sm font-bold text-white">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="bg-white border-4 border-black rounded-2xl neobrutalism-shadow overflow-hidden">
                <div class="flex overflow-x-auto border-b-4 border-black bg-gray-50">
                    <button class="tab-btn active px-6 py-4 border-r-2 border-black font-bold whitespace-nowrap bg-white" data-tab="dashboard">
                        üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <button class="tab-btn px-6 py-4 border-r-2 border-black font-bold whitespace-nowrap bg-white" data-tab="users">
                        üë• ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                    </button>
                    <button class="tab-btn px-6 py-4 border-r-2 border-black font-bold whitespace-nowrap bg-white" data-tab="rooms">
                        üè† ‡∏´‡πâ‡∏≠‡∏á
                    </button>
                    <button class="tab-btn px-6 py-4 border-r-2 border-black font-bold whitespace-nowrap bg-white" data-tab="admin">
                        üõ°Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Admin
                    </button>
                    <button class="tab-btn px-6 py-4 border-r-2 border-black font-bold whitespace-nowrap bg-white" data-tab="reports">
                        üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                    </button>
                    <button class="tab-btn px-6 py-4 border-r-2 border-black font-bold whitespace-nowrap bg-white" data-tab="broadcast">
                        üì¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                    </button>
                    <button class="tab-btn px-6 py-4 font-bold whitespace-nowrap bg-white" data-tab="settings">
                        ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>
                </div>

                <div class="p-6">
                    <!-- Dashboard Tab -->
                    <div id="dashboardTab" class="tab-content active">
                        <h2 class="text-2xl font-bold mb-6">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
                        
                        <!-- Activity Chart -->
                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-blue-50 border-2 border-blue-400 rounded-xl p-6">
                                <h3 class="text-xl font-bold mb-4">üìà ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                                <div id="recentActivity" class="space-y-2 max-h-64 overflow-y-auto">
                                    <p class="text-gray-500 text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 border-2 border-green-400 rounded-xl p-6">
                                <h3 class="text-xl font-bold mb-4">üî• ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
                                <div id="topUsers" class="space-y-2 max-h-64 overflow-y-auto">
                                    <p class="text-gray-500 text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
                                </div>
                            </div>
                        </div>

                        <!-- System Status -->
                        <div class="bg-white border-2 border-black rounded-xl p-6">
                            <h3 class="text-xl font-bold mb-4">üíª ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏∞‡∏ö‡∏ö</h3>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="bg-green-100 border-2 border-black rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-bold">Firebase</span>
                                        <span class="text-green-600">‚óè ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
                                    </div>
                                    <p class="text-sm text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏õ‡∏Å‡∏ï‡∏¥</p>
                                </div>
                                <div class="bg-blue-100 border-2 border-black rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-bold">Database</span>
                                        <span id="dbStatus" class="text-blue-600">‚óè ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                                    </div>
                                    <p class="text-sm text-gray-600">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: <span id="dbUsage">0</span> KB</p>
                                </div>
                                <div class="bg-purple-100 border-2 border-black rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="font-bold">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô</span>
                                        <span class="text-purple-600">v2.0</span>
                                    </div>
                                    <p class="text-sm text-gray-600">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: 2024</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Tab -->
                    <div id="usersTab" class="tab-content">
                        <h2 class="text-2xl font-bold mb-4">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
                        
                        <!-- Search & Filter -->
                        <div class="flex gap-4 mb-4 flex-wrap">
                            <input type="text" id="userSearch" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ..." class="flex-1 px-4 py-2 border-2 border-black rounded-lg">
                            <select id="userFilter" class="px-4 py-2 border-2 border-black rounded-lg font-bold">
                                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                <option value="admin">Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
                                <option value="user">User ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤</option>
                            </select>
                            <button id="loadUsersBtn" class="px-6 py-2 bg-blue-500 text-white border-2 border-black rounded-lg font-bold hover:bg-blue-600">
                                ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                            </button>
                        </div>

                        <div id="usersList" class="space-y-3 max-h-[600px] overflow-y-auto">
                            <p class="text-center text-gray-500 py-8 bg-gray-50 rounded-lg">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</p>
                        </div>
                    </div>

                    <!-- Rooms Tab -->
                    <div id="roomsTab" class="tab-content">
                        <h2 class="text-2xl font-bold mb-4">üè† ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó</h2>
                        
                        <div class="flex gap-4 mb-4 flex-wrap">
                            <button id="loadActiveRooms" class="flex-1 px-6 py-3 bg-green-500 text-white border-2 border-black rounded-lg font-bold hover:bg-green-600">
                                üì° ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà
                            </button>
                            <button id="loadAllRooms" class="flex-1 px-6 py-3 bg-blue-500 text-white border-2 border-black rounded-lg font-bold hover:bg-blue-600">
                                üìã ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button id="clearEmptyRooms" class="flex-1 px-6 py-3 bg-orange-500 text-white border-2 border-black rounded-lg font-bold hover:bg-orange-600">
                                üßπ ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
                            </button>
                        </div>

                        <div id="roomsList" class="space-y-3 max-h-[600px] overflow-y-auto">
                            <p class="text-center text-gray-500 py-8 bg-gray-50 rounded-lg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏´‡πâ‡∏≠‡∏á</p>
                        </div>
                    </div>

                    <!-- Admin Tab -->
                    <div id="adminTab" class="tab-content">
                        <h2 class="text-2xl font-bold mb-6">üõ°Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Admin</h2>
                        
                        <!-- Current Admin Info -->
                        <div class="bg-blue-50 border-2 border-blue-400 rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
                            <p id="currentAdminEmail" class="text-sm mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•: -</p>
                            <p id="currentAdminUID" class="text-sm mb-2">UID: -</p>
                            <span class="inline-block bg-green-500 text-white px-3 py-1 rounded-full text-sm font-bold">
                                ‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô Admin
                            </span>
                        </div>

                        <!-- Make Admin by Email -->
                        <div class="bg-white border-2 border-black rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">üìß ‡∏ï‡∏±‡πâ‡∏á Admin ‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h3>
                            <div class="flex gap-4">
                                <input type="email" id="adminEmail" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" class="flex-1 px-4 py-3 border-2 border-black rounded-lg">
                                <button id="makeAdminBtn" class="px-6 py-3 bg-red-500 text-white border-2 border-black rounded-lg font-bold hover:bg-red-600">
                                    ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin
                                </button>
                            </div>
                        </div>

                        <!-- Admin List -->
                        <div class="bg-white border-2 border-black rounded-xl p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold">üëë Admin ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                                <button id="loadAdminsBtn" class="px-4 py-2 bg-purple-500 text-white border-2 border-black rounded-lg font-bold hover:bg-purple-600">
                                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                                </button>
                            </div>
                            <div id="adminsList" class="space-y-2">
                                <p class="text-center text-gray-500 py-4">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</p>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div id="reportsTab" class="tab-content">
                        <h2 class="text-2xl font-bold mb-6">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- User Report -->
                            <div class="bg-white border-2 border-black rounded-xl p-6">
                                <h3 class="text-xl font-bold mb-4">üë• ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between p-3 bg-blue-50 rounded-lg">
                                        <span>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                                        <span id="newUsersToday" class="font-bold">0</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-green-50 rounded-lg">
                                        <span>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                                        <span id="activeUsersToday" class="font-bold">0</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-purple-50 rounded-lg">
                                        <span>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
                                        <span id="avgOnlineTime" class="font-bold">0 ‡∏ô‡∏≤‡∏ó‡∏µ</span>
                                    </div>
                                </div>
                                <button id="exportUsersBtn" class="w-full mt-4 px-4 py-2 bg-blue-500 text-white border-2 border-black rounded-lg font-bold hover:bg-blue-600">
                                    üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                                </button>
                            </div>

                            <!-- Room Report -->
                            <div class="bg-white border-2 border-black rounded-xl p-6">
                                <h3 class="text-xl font-bold mb-4">üè† ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏´‡πâ‡∏≠‡∏á</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between p-3 bg-green-50 rounded-lg">
                                        <span>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</span>
                                        <span id="roomsActive" class="font-bold">0</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-orange-50 rounded-lg">
                                        <span>‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</span>
                                        <span id="roomsEmpty" class="font-bold">0</span>
                                    </div>
                                    <div class="flex justify-between p-3 bg-purple-50 rounded-lg">
                                        <span>‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</span>
                                        <span id="busiestRoom" class="font-bold">-</span>
                                    </div>
                                </div>
                                <button id="exportRoomsBtn" class="w-full mt-4 px-4 py-2 bg-green-500 text-white border-2 border-black rounded-lg font-bold hover:bg-green-600">
                                    üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á
                                </button>
                            </div>
                        </div>

                        <!-- Activity Log -->
                        <div class="bg-white border-2 border-black rounded-xl p-6 mt-6">
                            <h3 class="text-xl font-bold mb-4">üìù Log ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
                            <div id="activityLog" class="space-y-2 max-h-96 overflow-y-auto bg-gray-50 rounded-lg p-4">
                                <p class="text-gray-500 text-center">‡πÑ‡∏°‡πà‡∏°‡∏µ log</p>
                            </div>
                        </div>
                    </div>

                    <!-- Broadcast Tab -->
                    <div id="broadcastTab" class="tab-content">
                        <h2 class="text-2xl font-bold mb-6">üì¢ ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h2>
                        
                        <div class="bg-yellow-50 border-2 border-yellow-400 rounded-xl p-4 mb-6">
                            <p class="text-sm text-yellow-800 font-bold">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô</p>
                        </div>

                        <div class="bg-white border-2 border-black rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">‚úçÔ∏è ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</h3>
                            <input type="text" id="announceTitle" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®" class="w-full px-4 py-3 border-2 border-black rounded-lg mb-4">
                            <textarea id="announceMessage" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®..." class="w-full px-4 py-3 border-2 border-black rounded-lg mb-4 h-32"></textarea>
                            
                            <div class="flex gap-4 mb-4">
                                <select id="announceType" class="px-4 py-2 border-2 border-black rounded-lg font-bold">
                                    <option value="info">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</option>
                                    <option value="warning">‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</option>
                                    <option value="success">‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</option>
                                    <option value="error">‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</option>
                                </select>
                            </div>

                            <button id="sendAnnounce" class="w-full px-6 py-3 bg-blue-500 text-white border-2 border-black rounded-lg font-bold hover:bg-blue-600">
                                üì¢ ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®
                            </button>
                        </div>

                        <!-- Previous Announcements -->
                        <div class="bg-white border-2 border-black rounded-xl p-6">
                            <h3 class="text-xl font-bold mb-4">üìã ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</h3>
                            <div id="announceList" class="space-y-2 max-h-96 overflow-y-auto">
                                <p class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div id="settingsTab" class="tab-content">
                        <h2 class="text-2xl font-bold mb-6">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
                        
                        <!-- Database Actions -->
                        <div class="bg-white border-2 border-black rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">üóÑÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <button id="backupDB" class="px-6 py-3 bg-blue-500 text-white border-2 border-black rounded-lg font-bold hover:bg-blue-600">
                                    üíæ ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                </button>
                                <button id="exportStats" class="px-6 py-3 bg-green-500 text-white border-2 border-black rounded-lg font-bold hover:bg-green-600">
                                    üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                                </button>
                            </div>
                        </div>

                        <!-- Danger Zone -->
                        <div class="bg-red-50 border-2 border-red-500 rounded-xl p-6">
                            <h3 class="text-xl font-bold mb-4 text-red-800">‚ö†Ô∏è Danger Zone</h3>
                            <div class="space-y-3">
                                <button id="clearAllRooms" class="w-full px-6 py-3 bg-orange-500 text-white border-2 border-black rounded-lg font-bold hover:bg-orange-600">
                                    üóëÔ∏è ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                </button>
                                <button id="clearMessages" class="w-full px-6 py-3 bg-red-500 text-white border-2 border-black rounded-lg font-bold hover:bg-red-600">
                                    üí¨ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                </button>
                                <button id="resetDB" class="w-full px-6 py-3 bg-red-700 text-white border-2 border-black rounded-lg font-bold hover:bg-red-800">
                                    üí£ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢!)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" style="display:none;" class="fixed bottom-4 right-4 px-6 py-3 bg-blue-500 text-white border-2 border-black rounded-lg font-bold shadow-lg z-50"></div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDyAVYvI5O327uh6LZAJELHpa9XHQ8_J3Q",
            authDomain: "chat-online-project-187e9.firebaseapp.com",
            databaseURL: "https://chat-online-project-187e9-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "chat-online-project-187e9",
            storageBucket: "chat-online-project-187e9.firebasestorage.app",
            messagingSenderId: "238726912803",
            appId: "1:238726912803:web:342c5669f6edd8cbb48a96",
            measurementId: "G-SL9N8KG89G"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        let currentUser = null;

        // Toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500', warning: 'bg-orange-500' };
            toast.className = `fixed bottom-4 right-4 px-6 py-3 text-white border-2 border-black rounded-lg font-bold shadow-lg z-50 ${colors[type]}`;
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 3000);
        }

        // Tab Switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(tab + 'Tab').classList.add('active');
            });
        });

        // Load Stats
        async function loadStats() {
            try {
                const [usersSnap, roomsSnap] = await Promise.all([
                    database.ref('users').once('value'),
                    database.ref('rooms').once('value')
                ]);
                
                const users = usersSnap.val() || {};
                const rooms = roomsSnap.val() || {};
                
                const totalUsers = Object.keys(users).length;
                const totalAdmins = Object.values(users).filter(u => u.isAdmin).length;
                const totalRooms = Object.keys(rooms).length;
                
                // Count messages
                let totalMessages = 0;
                Object.values(rooms).forEach(room => {
                    if (room.messages) {
                        totalMessages += Object.keys(room.messages).length;
                    }
                });
                
                document.getElementById('statUsers').textContent = totalUsers;
                document.getElementById('statAdmins').textContent = totalAdmins;
                document.getElementById('statRooms').textContent = totalRooms;
                document.getElementById('statMessages').textContent = totalMessages;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load Recent Activity
        async function loadRecentActivity() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '<p class="text-gray-500 text-center py-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
            
            try {
                const snapshot = await database.ref('users').limitToLast(10).once('value');
                const users = snapshot.val() || {};
                
                container.innerHTML = '';
                Object.entries(users).reverse().forEach(([uid, user]) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200';
                    div.innerHTML = `
                        <div class="w-8 h-8 bg-blue-400 rounded-full flex items-center justify-center text-white font-bold">
                            ${(user.username || user.email || '?')[0].toUpperCase()}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-bold text-sm truncate">${user.username || user.email || 'Unknown'}</p>
                            <p class="text-xs text-gray-500">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</p>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                container.innerHTML = '<p class="text-red-500 text-center py-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        }

        // Load Top Users
        async function loadTopUsers() {
            const container = document.getElementById('topUsers');
            container.innerHTML = '<p class="text-gray-500 text-center py-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
            
            try {
                const snapshot = await database.ref('users').once('value');
                const users = snapshot.val() || {};
                
                const sortedUsers = Object.entries(users)
                    .map(([uid, user]) => ({ uid, ...user }))
                    .sort((a, b) => (b.onlineTime || 0) - (a.onlineTime || 0))
                    .slice(0, 10);
                
                container.innerHTML = '';
                sortedUsers.forEach((user, index) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200';
                    div.innerHTML = `
                        <div class="text-2xl">${['ü•á', 'ü•à', 'ü•â'][index] || 'üë§'}</div>
                        <div class="flex-1 min-w-0">
                            <p class="font-bold text-sm truncate">${user.username || user.email || 'Unknown'}</p>
                            <p class="text-xs text-gray-500">‚è±Ô∏è ${user.onlineTime || 0} ‡∏ô‡∏≤‡∏ó‡∏µ</p>
                        </div>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                container.innerHTML = '<p class="text-red-500 text-center py-2">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        }

        // Load Users
        document.getElementById('loadUsersBtn').addEventListener('click', async function() {
            const container = document.getElementById('usersList');
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const filter = document.getElementById('userFilter').value;
            
            container.innerHTML = '<p class="text-center py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
            
            try {
                const snapshot = await database.ref('users').once('value');
                const users = snapshot.val() || {};
                
                container.innerHTML = '';
                let count = 0;
                
                Object.entries(users).forEach(([uid, userData]) => {
                    const matchesSearch = !searchTerm || 
                        (userData.email || '').toLowerCase().includes(searchTerm) ||
                        (userData.username || '').toLowerCase().includes(searchTerm);
                    
                    const matchesFilter = filter === 'all' ||
                        (filter === 'admin' && userData.isAdmin) ||
                        (filter === 'user' && !userData.isAdmin);
                    
                    if (matchesSearch && matchesFilter) {
                        count++;
                        const div = document.createElement('div');
                        div.className = `border-2 border-black rounded-lg p-4 ${userData.isAdmin ? 'bg-red-50' : 'bg-white'}`;
                        div.innerHTML = `
                            <div class="flex justify-between items-start gap-4">
                                <div class="flex-1 min-w-0">
                                    <p class="font-bold text-lg truncate">${userData.username || userData.email || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠'}</p>
                                    <p class="text-sm text-gray-600 truncate">${userData.email || '-'}</p>
                                    <p class="text-xs text-gray-500">UID: ${uid}</p>
                                    <div class="mt-2 flex gap-2 flex-wrap">
                                        ${userData.isAdmin ? '<span class="bg-red-500 text-white px-2 py-1 rounded text-xs font-bold">üõ°Ô∏è Admin</span>' : ''}
                                        ${userData.onlineTime ? `<span class="bg-blue-400 px-2 py-1 rounded text-xs font-bold">‚è±Ô∏è ${userData.onlineTime} ‡∏ô‡∏≤‡∏ó‡∏µ</span>` : ''}
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="toggleAdmin('${uid}', ${!userData.isAdmin})" class="px-4 py-2 ${userData.isAdmin ? 'bg-gray-300' : 'bg-red-500 text-white'} border-2 border-black rounded-lg font-bold whitespace-nowrap">
                                        ${userData.isAdmin ? '‚ùå ‡∏•‡∏ö' : '‚úÖ ‡∏ï‡∏±‡πâ‡∏á'}
                                    </button>
                                    <button onclick="deleteUser('${uid}')" class="px-4 py-2 bg-red-600 text-white border-2 border-black rounded-lg font-bold">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        `;
                        container.appendChild(div);
                    }
                });
                
                if (count === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</p>';
                } else {
                    showToast(`‡πÇ‡∏´‡∏•‡∏î ${count} ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                }
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<p class="text-center text-red-500 py-8">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        });

        // Search users on input
        document.getElementById('userSearch').addEventListener('input', function() {
            document.getElementById('loadUsersBtn').click();
        });

        document.getElementById('userFilter').addEventListener('change', function() {
            document.getElementById('loadUsersBtn').click();
        });

        // Toggle Admin
        window.toggleAdmin = async function(uid, makeAdmin) {
            try {
                await database.ref('users/' + uid).update({ isAdmin: makeAdmin });
                showToast(makeAdmin ? '‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin' : '‚ùå ‡∏•‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå Admin', 'success');
                document.getElementById('loadUsersBtn').click();
                loadStats();
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        };

        // Delete User
        window.deleteUser = async function(uid) {
            if (uid === currentUser.uid) {
                showToast('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ', 'error');
                return;
            }
            
            if (confirm('‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?')) {
                try {
                    await database.ref('users/' + uid).remove();
                    showToast('‚úÖ ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    document.getElementById('loadUsersBtn').click();
                    loadStats();
                } catch (error) {
                    showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                }
            }
        };

        // Load Rooms
        document.getElementById('loadActiveRooms').addEventListener('click', async function() {
            const container = document.getElementById('roomsList');
            container.innerHTML = '<p class="text-center py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
            
            try {
                const snapshot = await database.ref('rooms').once('value');
                const rooms = snapshot.val() || {};
                
                const activeRooms = Object.entries(rooms).filter(([id, room]) => 
                    room.active || (room.participants && Object.keys(room.participants).length > 0)
                );
                
                if (activeRooms.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</p>';
                    return;
                }
                
                container.innerHTML = '';
                activeRooms.forEach(([roomId, roomData]) => {
                    const div = document.createElement('div');
                    div.className = 'border-2 border-black rounded-lg p-4 bg-green-50';
                    div.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <p class="font-bold text-lg">üè† ${roomData.name || roomId}</p>
                                <p class="text-sm text-gray-600">ID: ${roomId}</p>
                                <p class="text-sm">üë• ${roomData.participants ? Object.keys(roomData.participants).length : 0} ‡∏Ñ‡∏ô</p>
                                <p class="text-sm">üí¨ ${roomData.messages ? Object.keys(roomData.messages).length : 0} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
                                <span class="inline-block mt-2 bg-green-500 text-white px-2 py-1 rounded text-xs font-bold">‚óè ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="viewRoom('${roomId}')" class="px-4 py-2 bg-blue-500 text-white border-2 border-black rounded-lg font-bold">
                                    üëÅÔ∏è
                                </button>
                                <button onclick="deleteRoom('${roomId}')" class="px-4 py-2 bg-red-500 text-white border-2 border-black rounded-lg font-bold">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
                
                showToast(`‡∏û‡∏ö ${activeRooms.length} ‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà`, 'success');
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-500 py-8">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        });

        document.getElementById('loadAllRooms').addEventListener('click', async function() {
            const container = document.getElementById('roomsList');
            container.innerHTML = '<p class="text-center py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
            
            try {
                const snapshot = await database.ref('rooms').once('value');
                const rooms = snapshot.val() || {};
                
                if (Object.keys(rooms).length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á</p>';
                    return;
                }
                
                container.innerHTML = '';
                Object.entries(rooms).forEach(([roomId, roomData]) => {
                    const isActive = roomData.active || (roomData.participants && Object.keys(roomData.participants).length > 0);
                    const div = document.createElement('div');
                    div.className = `border-2 border-black rounded-lg p-4 ${isActive ? 'bg-green-50' : 'bg-white'}`;
                    div.innerHTML = `
                        <div class="flex justify-between items-start gap-4">
                            <div class="flex-1 min-w-0">
                                <p class="font-bold text-lg truncate">üè† ${roomData.name || roomId}</p>
                                <p class="text-sm text-gray-600 truncate">ID: ${roomId}</p>
                                <p class="text-sm">üë• ${roomData.participants ? Object.keys(roomData.participants).length : 0} ‡∏Ñ‡∏ô</p>
                                <p class="text-sm">üí¨ ${roomData.messages ? Object.keys(roomData.messages).length : 0} ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
                                <span class="inline-block mt-2 ${isActive ? 'bg-green-500' : 'bg-gray-400'} text-white px-2 py-1 rounded text-xs font-bold">
                                    ${isActive ? '‚óè ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà' : '‚óã ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}
                                </span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="viewRoom('${roomId}')" class="px-4 py-2 bg-blue-500 text-white border-2 border-black rounded-lg font-bold whitespace-nowrap">
                                    üëÅÔ∏è
                                </button>
                                <button onclick="deleteRoom('${roomId}')" class="px-4 py-2 bg-red-500 text-white border-2 border-black rounded-lg font-bold whitespace-nowrap">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
                
                showToast(`‡πÇ‡∏´‡∏•‡∏î ${Object.keys(rooms).length} ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-500 py-8">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        });

        // Clear Empty Rooms
        document.getElementById('clearEmptyRooms').addEventListener('click', async function() {
            if (!confirm('‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return;
            
            try {
                const snapshot = await database.ref('rooms').once('value');
                const rooms = snapshot.val() || {};
                
                let deleted = 0;
                for (const [roomId, roomData] of Object.entries(rooms)) {
                    const isEmpty = !roomData.participants || Object.keys(roomData.participants).length === 0;
                    if (isEmpty) {
                        await database.ref('rooms/' + roomId).remove();
                        deleted++;
                    }
                }
                
                showToast(`‚úÖ ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ${deleted} ‡∏´‡πâ‡∏≠‡∏á`, 'success');
                document.getElementById('loadAllRooms').click();
                loadStats();
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // View Room
        window.viewRoom = function(roomId) {
            alert(`‡∏î‡∏π‡∏´‡πâ‡∏≠‡∏á: ${roomId}\n(‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤)`);
        };

        // Delete Room
        window.deleteRoom = async function(roomId) {
            if (confirm('‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')) {
                try {
                    await database.ref('rooms/' + roomId).remove();
                    showToast('‚úÖ ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    document.getElementById('loadAllRooms').click();
                    loadStats();
                } catch (error) {
                    showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                }
            }
        };

        // Make Admin by Email
        document.getElementById('makeAdminBtn').addEventListener('click', async function() {
            const email = document.getElementById('adminEmail').value.trim();
            if (!email) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•', 'warning');
                return;
            }
            
            try {
                const snapshot = await database.ref('users').orderByChild('email').equalTo(email).once('value');
                if (!snapshot.exists()) {
                    showToast('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', 'error');
                    return;
                }
                
                const userId = Object.keys(snapshot.val())[0];
                await database.ref('users/' + userId).update({ isAdmin: true });
                showToast('‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Admin ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                document.getElementById('adminEmail').value = '';
                loadStats();
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // Load Admins
        document.getElementById('loadAdminsBtn').addEventListener('click', async function() {
            const container = document.getElementById('adminsList');
            container.innerHTML = '<p class="text-center py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
            
            try {
                const snapshot = await database.ref('users').once('value');
                const users = snapshot.val() || {};
                const admins = Object.entries(users).filter(([uid, user]) => user.isAdmin);
                
                if (admins.length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ Admin</p>';
                    return;
                }
                
                container.innerHTML = '';
                admins.forEach(([uid, userData]) => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center justify-between p-3 bg-red-50 rounded-lg border-2 border-red-300';
                    div.innerHTML = `
                        <div class="flex-1">
                            <p class="font-bold">${userData.username || userData.email}</p>
                            <p class="text-xs text-gray-600">${userData.email}</p>
                        </div>
                        <button onclick="toggleAdmin('${uid}', false)" class="px-3 py-1 bg-gray-300 border-2 border-black rounded-lg font-bold text-sm">
                            ‚ùå ‡∏•‡∏ö
                        </button>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-500 py-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        });

        // Send Announcement
        document.getElementById('sendAnnounce').addEventListener('click', async function() {
            const title = document.getElementById('announceTitle').value.trim();
            const message = document.getElementById('announceMessage').value.trim();
            const type = document.getElementById('announceType').value;
            
            if (!title || !message) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'warning');
                return;
            }
            
            try {
                const announce = {
                    title, message, type,
                    timestamp: Date.now(),
                    by: currentUser.email
                };
                
                await database.ref('announcements').push(announce);
                showToast('‚úÖ ‡∏™‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                
                document.getElementById('announceTitle').value = '';
                document.getElementById('announceMessage').value = '';
                loadAnnouncements();
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // Load Announcements
        async function loadAnnouncements() {
            const container = document.getElementById('announceList');
            try {
                const snapshot = await database.ref('announcements').limitToLast(10).once('value');
                const announces = snapshot.val() || {};
                
                if (Object.keys(announces).length === 0) {
                    container.innerHTML = '<p class="text-center text-gray-500 py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®</p>';
                    return;
                }
                
                container.innerHTML = '';
                Object.entries(announces).reverse().forEach(([id, data]) => {
                    const div = document.createElement('div');
                    const colors = {
                        info: 'bg-blue-50 border-blue-400',
                        warning: 'bg-yellow-50 border-yellow-400',
                        success: 'bg-green-50 border-green-400',
                        error: 'bg-red-50 border-red-400'
                    };
                    div.className = `${colors[data.type]} border-2 rounded-lg p-4`;
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <p class="font-bold">${data.title}</p>
                            <button onclick="deleteAnnounce('${id}')" class="text-red-500 font-bold">‚ùå</button>
                        </div>
                        <p class="text-sm mb-2">${data.message}</p>
                        <p class="text-xs text-gray-500">‡πÇ‡∏î‡∏¢: ${data.by}</p>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                container.innerHTML = '<p class="text-center text-red-500 py-4">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        }

        window.deleteAnnounce = async function(id) {
            if (confirm('‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡πâ?')) {
                try {
                    await database.ref('announcements/' + id).remove();
                    showToast('‚úÖ ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    loadAnnouncements();
                } catch (error) {
                    showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                }
            }
        };

        // Export Users
        document.getElementById('exportUsersBtn').addEventListener('click', async function() {
            try {
                const snapshot = await database.ref('users').once('value');
                const users = snapshot.val() || {};
                
                const csv = 'UID,Email,Username,IsAdmin,OnlineTime\n' +
                    Object.entries(users).map(([uid, user]) =>
                        `${uid},${user.email || ''},${user.username || ''},${user.isAdmin || false},${user.onlineTime || 0}`
                    ).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'users_export.csv';
                a.click();
                
                showToast('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // Export Rooms
        document.getElementById('exportRoomsBtn').addEventListener('click', async function() {
            try {
                const snapshot = await database.ref('rooms').once('value');
                const rooms = snapshot.val() || {};
                
                const csv = 'RoomID,Name,Participants,Messages,Active\n' +
                    Object.entries(rooms).map(([id, room]) =>
                        `${id},${room.name || ''},${room.participants ? Object.keys(room.participants).length : 0},${room.messages ? Object.keys(room.messages).length : 0},${room.active || false}`
                    ).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'rooms_export.csv';
                a.click();
                
                showToast('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // Backup Database
        document.getElementById('backupDB').addEventListener('click', async function() {
            try {
                const snapshot = await database.ref('/').once('value');
                const data = snapshot.val();
                
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_${Date.now()}.json`;
                a.click();
                
                showToast('‚úÖ ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // Export Stats
        document.getElementById('exportStats').addEventListener('click', async function() {
            try {
                const [usersSnap, roomsSnap] = await Promise.all([
                    database.ref('users').once('value'),
                    database.ref('rooms').once('value')
                ]);
                
                const users = usersSnap.val() || {};
                const rooms = roomsSnap.val() || {};
                
                const stats = {
                    totalUsers: Object.keys(users).length,
                    totalAdmins: Object.values(users).filter(u => u.isAdmin).length,
                    totalRooms: Object.keys(rooms).length,
                    activeRooms: Object.values(rooms).filter(r => r.active).length,
                    timestamp: new Date().toISOString()
                };
                
                const json = JSON.stringify(stats, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `stats_${Date.now()}.json`;
                a.click();
                
                showToast('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // Danger Zone Actions
        document.getElementById('clearAllRooms').addEventListener('click', async function() {
            if (confirm('‚ö†Ô∏è ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!')) {
                if (confirm('‚ö†Ô∏è ‡πÅ‡∏ô‡πà‡πÉ‡∏à 100%?')) {
                    try {
                        await database.ref('rooms').remove();
                        showToast('‚úÖ ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                        loadStats();
                    } catch (error) {
                        showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                    }
                }
            }
        });

        document.getElementById('clearMessages').addEventListener('click', async function() {
            if (confirm('‚ö†Ô∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!')) {
                if (confirm('‚ö†Ô∏è ‡πÅ‡∏ô‡πà‡πÉ‡∏à 100%?')) {
                    try {
                        const snapshot = await database.ref('rooms').once('value');
                        const rooms = snapshot.val() || {};
                        
                        for (const roomId of Object.keys(rooms)) {
                            await database.ref('rooms/' + roomId + '/messages').remove();
                        }
                        
                        showToast('‚úÖ ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                        loadStats();
                    } catch (error) {
                        showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                    }
                }
            }
        });

        document.getElementById('resetDB').addEventListener('click', async function() {
            const confirm1 = prompt('‡∏û‡∏¥‡∏°‡∏û‡πå "RESET DATABASE" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô:');
            if (confirm1 !== 'RESET DATABASE') {
                showToast('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', 'info');
                return;
            }
            
            const confirm2 = prompt('‡πÅ‡∏ô‡πà‡πÉ‡∏à 100%? ‡∏û‡∏¥‡∏°‡∏û‡πå "YES":');
            if (confirm2 !== 'YES') {
                showToast('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', 'info');
                return;
            }
            
            try {
                await database.ref('/').remove();
                showToast('üí£ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î...', 'success');
                setTimeout(() => location.reload(), 2000);
            } catch (error) {
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            if (confirm('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?')) {
                try {
                    await auth.signOut();
                    window.location.href = 'index.html';
                } catch (error) {
                    showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
                }
            }
        });

        // Auth State
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'LoginPage.html';
                return;
            }
            
            currentUser = user;
            
            try {
                const snapshot = await database.ref('users/' + user.uid).once('value');
                const userData = snapshot.val();
                
                if (!userData || !userData.isAdmin) {
                    alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á');
                    window.location.href = 'index.html';
                    return;
                }
                
                document.getElementById('headerEmail').textContent = user.email;
                document.getElementById('currentAdminEmail').textContent = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ' + user.email;
                document.getElementById('currentAdminUID').textContent = 'UID: ' + user.uid;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // Load initial data
                loadStats();
                loadRecentActivity();
                loadTopUsers();
                loadAnnouncements();
                
                showToast('‚úÖ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö Admin!', 'success');
                
                // Load additional statistics
                setTimeout(() => {
                    loadRoomStatistics();
                    loadUserStatistics();
                }, 1000);
            } catch (error) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                window.location.href = 'index.html';
            }
        });

        // ========================================
        // üîß ENHANCED FEATURES - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà
        // ========================================

        // Enhanced View Room with full details
        window.viewRoomDetails = async function(roomId) {
            try {
                const snapshot = await database.ref('rooms/' + roomId).once('value');
                const room = snapshot.val();
                
                if (!room) {
                    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á');
                    return;
                }
                
                const memberCount = room.members ? Object.keys(room.members).length : 0;
                const messageCount = room.messages ? Object.keys(room.messages).length : 0;
                
                // Create modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.right = '0';
                modal.style.bottom = '0';
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
                modal.style.zIndex = '9999';
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
                
                modal.innerHTML = `
                    <div class="bg-white border-4 border-black rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto" style="max-width: 42rem; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-2xl font-bold">üè† ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-3xl hover:text-gray-600">&times;</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-4">
                                <h4 class="font-bold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4>
                                <p><strong>‡πÇ‡∏Ñ‡πâ‡∏î‡∏´‡πâ‡∏≠‡∏á:</strong> ${room.code || roomId}</p>
                                <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${room.type || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</p>
                                <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${room.isActive !== false ? 'üü¢ Active' : '‚ö™ Inactive'}</p>
                                <p><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> ${room.createdAt || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö'}</p>
                            </div>
                            
                            <div class="bg-green-50 border-2 border-green-400 rounded-lg p-4">
                                <h4 class="font-bold mb-2">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (${memberCount} ‡∏Ñ‡∏ô)</h4>
                                <div class="space-y-2 max-h-48 overflow-y-auto">
                                    ${room.members ? Object.entries(room.members).map(([uid, member]) => `
                                        <div class="bg-white p-2 rounded border border-gray-300">
                                            <p class="font-bold">${member.username || 'Unknown'}</p>
                                            <p class="text-xs text-gray-500">UID: ${uid}</p>
                                        </div>
                                    `).join('') : '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</p>'}
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 border-2 border-purple-400 rounded-lg p-4">
                                <h4 class="font-bold mb-2">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (${messageCount})</h4>
                                <div class="space-y-2" style="max-height: 16rem; overflow-y: auto;">
                                    ${room.messages ? Object.entries(room.messages).slice(-10).reverse().map(([msgId, msg]) => `
                                        <div class="bg-white p-2 rounded border border-gray-300">
                                            <p class="font-bold text-sm">${msg.username || 'Unknown'}</p>
                                            <p class="text-sm">${msg.text || msg.message || ''}</p>
                                            <p class="text-xs text-gray-500">${new Date(msg.timestamp).toLocaleString('th-TH')}</p>
                                        </div>
                                    `).join('') : '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>'}
                                </div>
                            </div>
                            
                            <div class="flex gap-2">
                                <button onclick="window.location.href='RoomPage.html?code=${room.code || roomId}'" class="flex-1 px-4 py-2 bg-blue-500 text-white border-2 border-black rounded-lg font-bold hover:bg-blue-600">
                                    üö™ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á
                                </button>
                                <button onclick="if(confirm('‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')) { deleteRoom('${roomId}'); this.closest('[style*=fixed]').remove(); }" class="flex-1 px-4 py-2 bg-red-500 text-white border-2 border-black rounded-lg font-bold hover:bg-red-600">
                                    üóëÔ∏è ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            } catch (error) {
                console.error('Error viewing room:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á');
            }
        };

        // Override viewRoom to use enhanced version
        window.viewRoom = window.viewRoomDetails;

        // Enhanced View User with full details
        window.viewUserDetails = async function(uid) {
            try {
                const snapshot = await database.ref('users/' + uid).once('value');
                const user = snapshot.val();
                
                if (!user) {
                    alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
                    return;
                }
                
                // Create modal
                const modal = document.createElement('div');
                modal.style.position = 'fixed';
                modal.style.top = '0';
                modal.style.left = '0';
                modal.style.right = '0';
                modal.style.bottom = '0';
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
                modal.style.zIndex = '9999';
                modal.style.padding = '1rem';
                modal.onclick = (e) => {
                    if (e.target === modal) modal.remove();
                };
                
                modal.innerHTML = `
                    <div class="bg-white border-4 border-black rounded-2xl p-6" style="max-width: 32rem; width: 100%;" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-2xl font-bold">üë§ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-3xl hover:text-gray-600">&times;</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-4">
                                <h4 class="font-bold mb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h4>
                                <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong> ${user.username || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</p>
                                <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> ${user.email}</p>
                                <p><strong>UID:</strong> ${uid}</p>
                            </div>
                            
                            <div class="bg-green-50 border-2 border-green-400 rounded-lg p-4">
                                <h4 class="font-bold mb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h4>
                                <p><strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå:</strong> ${user.onlineTime || 0} ‡∏ô‡∏≤‡∏ó‡∏µ</p>
                                <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${user.isAdmin ? 'üõ°Ô∏è Admin' : 'üë§ User'}</p>
                                <p><strong>‡πÅ‡∏ö‡∏ô:</strong> ${user.banned ? '‚ùå ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô' : '‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥'}</p>
                            </div>
                            
                            ${user.theme ? `
                                <div class="bg-purple-50 border-2 border-purple-400 rounded-lg p-4">
                                    <h4 class="font-bold mb-2">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h4>
                                    <p><strong>‡∏ò‡∏µ‡∏°:</strong> ${user.theme}</p>
                                </div>
                            ` : ''}
                            
                            <div class="flex gap-2 flex-wrap">
                                <button onclick="toggleAdmin('${uid}', ${!user.isAdmin}); this.parentElement.parentElement.parentElement.parentElement.remove();" class="flex-1 px-4 py-2 ${user.isAdmin ? 'bg-gray-500' : 'bg-red-500'} text-white border-2 border-black rounded-lg font-bold">
                                    ${user.isAdmin ? '‚ùå ‡∏•‡∏ö Admin' : '‚úÖ ‡∏ï‡∏±‡πâ‡∏á Admin'}
                                </button>
                                <button onclick="banUser('${uid}')" class="flex-1 px-4 py-2 bg-orange-500 text-white border-2 border-black rounded-lg font-bold">
                                    ${user.banned ? 'üîì ‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô' : 'üîí ‡πÅ‡∏ö‡∏ô'}
                                </button>
                                <button onclick="if(confirm('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?')) { deleteUser('${uid}'); this.parentElement.parentElement.parentElement.parentElement.remove(); }" class="flex-1 px-4 py-2 bg-red-600 text-white border-2 border-black rounded-lg font-bold">
                                    üóëÔ∏è ‡∏•‡∏ö
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            } catch (error) {
                console.error('Error viewing user:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
            }
        };

        // Ban/Unban User
        window.banUser = async function(uid) {
            try {
                const snapshot = await database.ref('users/' + uid + '/banned').once('value');
                const isBanned = snapshot.val() || false;
                
                if (confirm(`${isBanned ? '‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô' : '‡πÅ‡∏ö‡∏ô'}‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?`)) {
                    await database.ref('users/' + uid).update({ banned: !isBanned });
                    showToast(`‚úÖ ${isBanned ? '‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô' : '‡πÅ‡∏ö‡∏ô'}‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                    document.getElementById('loadUsersBtn')?.click();
                }
            } catch (error) {
                console.error('Error banning user:', error);
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        };

        // Load Room Statistics
        window.loadRoomStatistics = async function() {
            try {
                const snapshot = await database.ref('rooms').once('value');
                const rooms = snapshot.val() || {};
                
                let totalMembers = 0;
                let totalMessages = 0;
                let activeRooms = 0;
                
                Object.values(rooms).forEach(room => {
                    if (room.members) totalMembers += Object.keys(room.members).length;
                    if (room.messages) totalMessages += Object.keys(room.messages).length;
                    if (room.isActive !== false && room.members && Object.keys(room.members).length > 0) {
                        activeRooms++;
                    }
                });
                
                if (document.getElementById('roomsActive')) {
                    document.getElementById('roomsActive').textContent = activeRooms;
                }
                if (document.getElementById('roomsEmpty')) {
                    document.getElementById('roomsEmpty').textContent = Object.keys(rooms).length - activeRooms;
                }
                
                console.log('‚úÖ Room statistics loaded');
            } catch (error) {
                console.error('‚ùå Error loading room statistics:', error);
            }
        };

        // Load User Statistics
        window.loadUserStatistics = async function() {
            try {
                const snapshot = await database.ref('users').once('value');
                const users = snapshot.val() || {};
                
                const now = Date.now();
                const oneDayAgo = now - (24 * 60 * 60 * 1000);
                
                let newUsersToday = 0;
                let activeUsersToday = 0;
                let totalOnlineTime = 0;
                let userCount = 0;
                
                Object.values(users).forEach(user => {
                    if (user.createdAt && new Date(user.createdAt).getTime() > oneDayAgo) {
                        newUsersToday++;
                    }
                    if (user.lastActive && user.lastActive > oneDayAgo) {
                        activeUsersToday++;
                    }
                    if (user.onlineTime) {
                        totalOnlineTime += user.onlineTime;
                        userCount++;
                    }
                });
                
                const avgOnlineTime = userCount > 0 ? Math.round(totalOnlineTime / userCount) : 0;
                
                if (document.getElementById('newUsersToday')) {
                    document.getElementById('newUsersToday').textContent = newUsersToday;
                }
                if (document.getElementById('activeUsersToday')) {
                    document.getElementById('activeUsersToday').textContent = activeUsersToday;
                }
                if (document.getElementById('avgOnlineTime')) {
                    document.getElementById('avgOnlineTime').textContent = avgOnlineTime + ' ‡∏ô‡∏≤‡∏ó‡∏µ';
                }
                
                console.log('‚úÖ User statistics loaded');
            } catch (error) {
                console.error('‚ùå Error loading user statistics:', error);
            }
        };

        console.log('‚úÖ Enhanced Admin Panel Features loaded');
        console.log('üìä Available functions:');
        console.log('  - viewRoomDetails(roomId)');
        console.log('  - viewUserDetails(uid)');
        console.log('  - banUser(uid)');
        console.log('  - loadRoomStatistics()');
        console.log('  - loadUserStatistics()');
    </script>
</body>
</html>
